---
interface Props {
  solutions: Record<string, string>;
  problemId: number;
}
const { solutions, problemId } = Astro.props;
const langs = Object.keys(solutions);

const EXT_MAP: Record<string, string> = {
  'C': 'c',
  'C++': 'cpp',
  'C#': 'csharp',
  'F#': 'fsharp',
  'Python': 'python',
  'Java': 'java',
  'Kotlin': 'kotlin',
  'Pascal': 'pascal',
  'Rust': 'rust',
  'Go': 'go',
  'Haskell': 'haskell',
};
---

<div class="code-preview">
  <div class="tab-bar" data-tabs={`tabs-${problemId}`}>
    {langs.map((lang, i) => (
      <button
        class={`tab ${i === 0 ? 'active' : ''}`}
        data-tab-target={`code-${problemId}-${i}`}
      >
        {lang}
      </button>
    ))}
  </div>
  <div class="code-panels">
    {langs.map((lang, i) => (
      <div
        class={`code-panel ${i === 0 ? 'active' : ''}`}
        id={`code-${problemId}-${i}`}
      >
        <pre><code class={`language-${EXT_MAP[lang] || 'text'}`}>{solutions[lang]}</code></pre>
      </div>
    ))}
  </div>
</div>

<script>
  document.querySelectorAll('.tab-bar').forEach((bar) => {
    const tabs = bar.querySelectorAll('.tab');
    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        const targetId = (tab as HTMLElement).dataset.tabTarget;
        if (!targetId) return;
        const preview = bar.closest('.code-preview');
        if (!preview) return;

        preview.querySelectorAll('.tab').forEach((t) => t.classList.remove('active'));
        preview.querySelectorAll('.code-panel').forEach((p) => p.classList.remove('active'));
        tab.classList.add('active');
        const panel = preview.querySelector(`#${targetId}`);
        if (panel) panel.classList.add('active');
      });
    });
  });
</script>

<style>
  .code-preview {
    background: var(--bg-code);
  }

  .tab-bar {
    display: flex;
    overflow-x: auto;
    border-bottom: 1px solid var(--border-color);
    padding: 0 0.5rem;
    scrollbar-width: thin;
    scrollbar-color: var(--border-color) transparent;
  }

  .tab-bar::-webkit-scrollbar {
    height: 4px;
  }

  .tab-bar::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 2px;
  }

  .tab {
    flex-shrink: 0;
    padding: 10px 16px;
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    color: var(--text-muted);
    font-size: 0.8rem;
    font-family: var(--font-sans);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .tab:hover {
    color: var(--text-secondary);
  }

  .tab.active {
    color: var(--accent-blue);
    border-bottom-color: var(--accent-blue);
  }

  .code-panel {
    display: none;
    max-height: 400px;
    overflow: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border-color) transparent;
  }

  .code-panel::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  .code-panel::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
  }

  .code-panel.active {
    display: block;
  }

  pre {
    margin: 0;
    padding: 1.25rem 1.5rem;
    overflow-x: auto;
  }

  code {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    line-height: 1.65;
    color: var(--text-primary);
    white-space: pre;
  }
</style>
